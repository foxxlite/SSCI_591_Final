<!doctype html>
<html lang="en">

<html>

<head>
  <!-- <meta name="viewport" content="initial-scale=1.0, user-scalable=no"> -->
  <meta charset="utf-8">
  <title>Oregon Apartments</title>
  <link rel="stylesheet" href="stylesheet.css">
  <!-- Place favicon in the browser tab -->
  <link rel="icon" type="image/png" href="/favicon.png"/>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="/locations.geojson"></script>
</head>

<body>
  <div class='sidebar' id='pad'>Listings</div>
  <div class='sidebar'>
    <div id='heading'>
      <h1>Oregon Locations</h1>
    </div>
    <div id='listings'></div>
  </div>
  <div id="map"></div>

  <!-- Initialize the map -->
  <!-- Help with the sidebar from -->
  <!-- https://www.mapbox.com/help/building-a-store-locator/#final-tweaks -->
<script>

function initMap() {
  var map = new google.maps.Map(document.getElementById('map'), {
    center: {lat: 44.276547, lng: -120.516643},
    zoom: 7.2
});

// Load the fusion table layer and apply styling
var layer = new google.maps.FusionTablesLayer({
  query: {
    select: 'description',
    from: '1Jk9L2xyykAauyYrKOQk0RPSKbm7U5pAW530KjvdJ'
  },
  styles: [{
    polygonOptions: {
      fillColor: '#76D7C4',
      fillOpacity: 0.65
  }
  }, {
  where: 'Percent_occupied_housing_units > 90',
    polygonOptions: {
      fillColor: '#17A589',
      fillOpacity: 0.65
    }
  }]
})

var locations = {
   "type": "FeatureCollection",
   "features":[
      {
         "type":"Feature",
         "properties":{
            "marker-color":"#7e7e7e",
            "marker-size":"medium",
            "marker-symbol":"",
            "name":"Bend Real Estate",
            "desc":"Portland",
            "listing":"https://www.apartments.com/seasons-at-farmington-bend-or/8krmcn2/"
         },
         "geometry":{
            "type":"Point",
            "coordinates":[
               -122.72140502929686,
               45.50730933674183
            ]
         }
      },
      {
         "type":"Feature",
         "properties":{
            "marker-color":"#7e7e7e",
            "marker-size":"medium",
            "marker-symbol":"",
            "name":"Tabor View Lofts",
            "desc":"Forest Grove",
            "listing":"https://www.apartments.com/portland-or/2/"
         },
         "geometry":{
            "type":"Point",
            "coordinates":[
               -122.64587402343751,
               45.556371735883125
            ]
         }
      },
      {
         "type":"Feature",
         "properties":{
            "marker-color":"#7e7e7e",
            "marker-size":"medium",
            "marker-symbol":"",
            "name":"Town and Country Apartments",
            "desc":"Portland",
            "listing":"https://www.apartments.com/portland-or/2/"
         },
         "geometry":{
            "type":"Point",
            "coordinates":[
               -122.59780883789061,
               45.51308360513238
            ]
         }
      },
      {
         "type":"Feature",
         "properties":{
            "marker-color":"#7e7e7e",
            "marker-size":"medium",
            "marker-symbol":"",
            "name":"The Courtyard on Stark",
            "desc":"Eugene",
            "listing":"https://www.apartments.com/portland-or/10/"
         },
         "geometry":{
            "type":"Point",
            "coordinates":[
               -122.63900756835938,
               45.51212126820532
            ]
         }
      },
      {
         "type":"Feature",
         "properties":{
            "marker-color":"#7e7e7e",
            "marker-size":"medium",
            "marker-symbol":"",
            "name":"Garden Glen Apartments",
            "desc":"Mount Tabor",
            "listing":"https://www.apartments.com/garden-glen-apartments-portland-or/wjvv2qj/"
         },
         "geometry":{
            "type":"Point",
            "coordinates":[
               -122.68981933593749,
               45.57560020947802
            ]
         }
      },
      {
         "type":"Feature",
         "properties":{
            "marker-color":"#7e7e7e",
            "marker-size":"medium",
            "marker-symbol":"",
            "name":"Commons at Timber Crekk Apartments",
            "desc":"Hillsboro",
            "listing":"https://www.apartments.com/commons-at-timber-creek-apartments-portland-or/3w6926f/"
         },
         "geometry":{
            "type":"Point",
            "coordinates":[
               -123.04687499999999,
               44.929807512153914
            ]
         }
      },
      {
         "type":"Feature",
         "properties":{
            "marker-color":"#7e7e7e",
            "marker-size":"medium",
            "marker-symbol":"",
            "name":"Broadway Center",
            "desc":"Gresham",
            "listing":"https://www.apartments.com/broadway-center-eugene-or/1pwbcg6/"
         },
         "geometry":{
            "type":"Point",
            "coordinates":[
               -123.11004638671874,
               44.63739123445585
            ]
         }
      },
      {
         "type":"Feature",
         "properties":{
            "marker-color":"#7e7e7e",
            "marker-size":"medium",
            "marker-symbol":"",
            "name":"Bailey Hills Meadows",
            "desc":"Portland",
            "listing":"https://www.apartments.com/bailey-hill-meadows-eugene-or/1pjvgk5/"
         },
         "geometry":{
            "type":"Point",
            "coordinates":[
               -121.3385009765625,
               44.040218713142146
            ]
         }
      },
      {
         "type":"Feature",
         "properties":{
            "marker-color":"#7e7e7e",
            "marker-size":"medium",
            "marker-symbol":"",
            "name":"Parkgrove Apartments",
            "desc":"Portland",
            "listing":"https://www.apartments.com/parkgrove-apartments-eugene-or/3xxswvd/"
         },
         "geometry":{
            "type":"Point",
            "coordinates":[
               -120.01739501953125,
               43.53660274231031
            ]
         }
      },
      {
         "type":"Feature",
         "properties":{
            "marker-color":"#7e7e7e",
            "marker-size":"medium",
            "marker-symbol":"",
            "name":"Outlook at Pilot Butte",
            "desc":"Bend",
            "listing":"https://www.apartments.com/outlook-at-pilot-butte-bend-or/f7ytgmr/"
         },
         "geometry":{
            "type":"Point",
            "coordinates":[
               -121.27944946289062,
               44.06982710133289
            ]
         }
      }
   ]
}


// Load external geojson
map.data.addGeoJson(locations);


// Load data into the sidebar
// Use jquery js library getJSON method to load json from local directory (root)
$.getJSON('locations.geojson', function buildLocationList(data) {
  // Iterate through the list of locations
  for (i = 0; i < data.features.length; i++) {
    var currentFeature = data.features[i];
    var prop = currentFeature.properties;
    // Select the listing container in the HTML and append a div
    // with the class 'item' for each location
    var listings = document.getElementById('listings');
    var listing = listings.appendChild(document.createElement('div'));
    listing.className = 'item';
    listing.id = 'listing-' + i;

    // Create a new link with the class 'title' for each location
    // and fill it with the store listing
    var link = listing.appendChild(document.createElement('a'));
    link.href = prop.listing;
    link.target = "_blank"
    link.className = 'title';
    link.dataPosition = i;
    link.innerHTML = prop.name;

    // Create a new div with the class 'details' for each store
    // and fill it with the city and phone number
    var details = listing.appendChild(document.createElement('div'));
    details.innerHTML = prop.desc;
  }
})

layer.setMap(map);

// Establish infowindow variable
// Help with infowindow from
// https://stackoverflow.com/questions/23814197/creating-infowindows-on-features-loaded-via-loadgeojson
var infowindow = new google.maps.InfoWindow();

// When the user clicks, open an infowindow
map.data.addListener('click', function(event) {
    var myHTML = event.feature.getProperty("name");
    infowindow.setContent("<div style='width:150px; text-align: center;'>"+myHTML+"</div>");
    infowindow.setPosition(event.feature.getGeometry().get());
    infowindow.setOptions({pixelOffset: new google.maps.Size(0,-30)});
    infowindow.open(map);
});

}

  </script>
  <script async defer
  src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCU-X6cOMKyzQUM8Gpv6ecoukCzOWlgEx8&q&callback=initMap">
  </script>
</body>
</html>
